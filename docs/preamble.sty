%! suppress = UsePackageInPackage
% Compiler
\usepackage[american]{babel}

% declare hyphens for non-english words and long family names
\hyphenation{Na-ka-mo-to}
\hyphenation{An-ton-opou-los}

% patch cmd
\usepackage{etoolbox}

% Colors
\usepackage[rgb, table]{xcolor}

% Links
\usepackage[
    colorlinks=true, % colored links
    allcolors=gray, % color gray
    breaklinks, % line break
    linktocpage % table of contents links to pages
]{hyperref}

% Refs
\usepackage{amsmath}
\usepackage[noabbrev]{cleveref}

% Quotes
\usepackage{csquotes}


% Document layout
\usepackage{fontspec}
\usepackage[pagestyles]{titlesec}
\usepackage[T1]{fontenc}
\usepackage{titling}
\usepackage{geometry}
\geometry{
    a4paper,
    bottom=1.5cm,
    top=1.5cm,
    left=2.5cm,
    right=2.5cm,
    includeheadfoot,
}

% microtyping (improves line breaks and hyphens)
\usepackage[activate={true,nocompatibility},final,tracking=true,factor=1100,stretch=10,shrink=10]{microtype}

% no widows
\usepackage[all]{nowidow}

% Array package
\usepackage{array}

% font declaration and title settings
% Style
\setmainfont[
    Ligatures=TeX,
    BoldFont={Montserrat Bold},
    ItalicFont={Montserrat Italic},
    BoldItalicFont={Montserrat Bold Italic},
]{Montserrat}
\renewcommand{\baselinestretch}{1.5}

\newfontfamily\headingfont[]{Helvetica}
\newfontfamily\titlefont[]{Helvetica}
\newcommand{\hsp}{\hspace{10pt}}
\definecolor{gray75}{gray}{0.75}

\titleformat{\chapter}[hang]{\Huge\headingfont}{\chaptertitlename\ \thechapter\hspace{10pt}\textcolor{gray75}{|}\hspace{10pt}}{0pt}{\Huge\headingfont}
\titleformat*{\section}{\LARGE\headingfont}
\titleformat*{\subsection}{\Large\headingfont}
\renewcommand{\maketitlehooka}{\headingfont}
\titlespacing{\chapter}{0pt}{0pt}{*4}
\titlespacing*{\chapter}{0pt}{0pt}{*4}
\titlespacing{\section}{0pt}{*2}{*2}
\titlespacing*{\section}{0pt}{*2}{*2}
\titlespacing{\subsection}{0pt}{*2}{*1.5}
\titlespacing*{\subsection}{0pt}{*2}{*1.5}
\titlespacing{\subsubsection}{0pt}{*1}{*1}
\titlespacing*{\subsubsection}{0pt}{*1}{*1}

% Set header and footer
\usepackage{fancyhdr}
\pagestyle{fancy}
\fancyhf{}                           % clear all header and footer fields
\fancyhead[L]{\raisebox{2mm}{\small\me}}
\fancyhead[C]{\raisebox{2mm}{\large\mytitle}}
\fancyhead[R]{\raisebox{2mm}{\small\publishedon}}
\cfoot{\thepage}                     % add page number
\renewcommand{\headrulewidth}{0.4pt} % add horizontal line of 0.4pt thick
% apply header to chapter pages
\patchcmd{\chapter}{\thispagestyle{plain}}{\thispagestyle{fancy}}{}{} % patch chapter page

\linespread{1.3}

% Captions
\usepackage{caption}
\captionsetup{position=below, font=small, skip=10px,  justification=justified}

% Notes
\newcommand{\addtablenote}[3]{
    \small
    Note. Based on~#1, by~#2. #3
}

\newcommand{\addfigurenote}[3]{
    \small
    Note. Taken from~#1, by~#2. #3
}

% Subcaptions
\usepackage{subcaption}

% example two figures side-by-side
%\begin{figure}[H]
%    \begin{subfigure}{.5\textwidth}
%        \centering
%        \includegraphics[width=.4\linewidth]{chandra-2014-asymmetric_key}
%        \caption{Asymmetric key pair}
%        \label{fig:asymmetric-key-pair}
%    \end{subfigure}
%    \begin{subfigure}{.5\textwidth}
%        \centering
%        \includegraphics[width=.4\linewidth]{chandra-2014-symmetric_key}
%        \caption{Asymmetric key pair}
%        \label{fig:asymmetric-key-paisr}
%    \end{subfigure}
%    \caption[Cryptographic keys]{Cryptographic keys~\autocite[84]{chandra_comparative_2014}}
%\end{figure}

% example two figures ordered vertically
%\begin{figure}[H]
%    \begin{subfigure}[b]{\textwidth}
%        \centering
%        \includegraphics[scale=0.4]{chandra-2014-symmetric_key}
%        \caption{Symmetric key}
%        \label{fig:symmetric-key}
%    \end{subfigure}
%    \begin{subfigure}[b]{\textwidth}
%        \centering
%        \includegraphics[scale=0.4]{chandra-2014-asymmetric_key}
%        \caption{Asymmetric key}
%        \label{fig:asymmetric-key}
%    \end{subfigure}
%    \caption[Cryptographic keys]{Cryptographic keys~\autocite[84]{chandra_comparative_2014}}
%\end{figure}

% Figures
\usepackage{graphicx}
\graphicspath{{./figures}}

% Tables
\usepackage{booktabs, tabularx}

% define collumn sizes
\newcolumntype{b}{X}
\newcolumntype{C}{>{\centering\arraybackslash}X}
\newcolumntype{s}{>{\hsize=.5\hsize}X}

% change note size
\usepackage[para, flushleft]{threeparttable}

% Symbols
\usepackage{amssymb}
\usepackage{pifont}
\newcommand{\cmark}{\ding{51}}
\newcommand{\xmark}{\ding{55}}
% \cmark

% Code
\usepackage[outputdir=out]{minted}

%% fix the minted@colorbg environment
\makeatletter
\renewenvironment{minted@colorbg}[1]
{\def\minted@bgcol{#1}%
\noindent
    \begin{lrbox}{\minted@bgbox}
        \begin{minipage}{\linewidth-2\fboxsep}}
        {\end{minipage}%
    \end{lrbox}%
    \setlength{\topsep}{\bigskipamount}% set the vertical space
    \trivlist\item\relax % ensure going to a new line
    \colorbox{\minted@bgcol}{\usebox{\minted@bgbox}}%
    \endtrivlist % close the trivlist
}
\makeatother

\usepackage{tcolorbox}
\tcbuselibrary{minted,skins,breakable,most}

% code snippet background color
\definecolor{CodeBG}{RGB}{30,45,62}


\newtcbinputlisting[auto counter,number within=chapter, list inside=listoflistings]{\codeFromFile}[6][]{
    listing engine=minted,
    listing file={#3},
    minted language=#2,
    minted style=material,
    minted options={
        fontsize=\scriptsize,
        formatcom=\color{white},
        linenos,
        breaklines,
        breakanywhere,
        numbersep=1mm,
        framesep=3mm,
    },
    colback=CodeBG,
    breakable,
    enhanced,
    halign=center,
    listing only,
    title={Listing \thetcbcounter: #4},
    list entry={\protect\numberline{\thetcbcounter}#5},
    label=#6,
    coltitle=black,
    colbacktitle=white,
    fonttitle=\small,
    attach boxed title to bottom center,
    boxed title style={
        frame hidden,
        top=5px,
        left=0cm,
    },
    #1
}

% line numbers color
\renewcommand{\theFancyVerbLine}{\ttfamily
\textcolor[rgb]{1,1,1}{\tiny{\arabic{FancyVerbLine}}}}

\newminted[jsxcode]{jsx}{linenos=true, texcl=true, bgcolor=CodeBG, breakanywhere}
\newminted[shellcode]{bash}{linenos=true, texcl=true, bgcolor=CodeBG, breakanywhere}
\newminted[pycode]{python}{linenos=true, texcl=true, bgcolor=CodeBG, breakanywhere}

% example for commands above
% \begin{jsxcode}
%   class HelloMessage extends React.Component {
%       render() {
%           return (
%               <div>
%                   Hello {this.props.name}
%               </div>
%           );
%       }
%   }
%
%   ReactDOM.render(
%       <HelloMessage name="Taylor" />,
%       document.getElementById('hello-example')
%   );
% \end{jsxcode}

% Abbreviations and glosaries
\usepackage{parskip}
\usepackage[toc, acronym]{glossaries}

% make glossaries
\makeglossaries

% Bibliograpyhy
\usepackage[
    style=authoryear-icomp,
    maxbibnames=9,
    maxcitenames=2,
    mincitenames=1,
    backend=biber,
]{biblatex}